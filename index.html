<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API测试工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        neutral: '#64748B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-height {
                transition: max-height 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8 text-center">
            <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-gray-800 mb-2">API测试工具</h1>
            <p class="text-gray-600">测试生产数据和员工管理API接口</p>
        </header>

        <!-- 端点选择器 -->
        <div class="mb-6 bg-white rounded-lg shadow-md p-4">
            <div class="flex flex-wrap gap-2 mb-4">
                <button class="endpoint-btn active px-4 py-2 rounded-md bg-primary text-white font-medium" data-endpoint="production-hour">
                    <i class="fa fa-clock-o mr-1"></i> 小时生产数据
                </button>
                <button class="endpoint-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700 font-medium" data-endpoint="production-day">
                    <i class="fa fa-calendar mr-1"></i> 日生产数据
                </button>
                <button class="endpoint-btn px-4 py-2 rounded-md bg-gray-200 text-gray-700 font-medium" data-endpoint="employees">
                    <i class="fa fa-users mr-1"></i> 员工数据
                </button>
            </div>
            
            <!-- 请求配置 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">请求方法</label>
                    <div class="flex flex-wrap gap-2">
                        <button class="method-btn active px-3 py-1 rounded bg-primary text-white text-sm" data-method="GET">GET</button>
                        <button class="method-btn px-3 py-1 rounded bg-secondary text-white text-sm" data-method="POST">POST</button>
                        <button class="method-btn px-3 py-1 rounded bg-blue-600 text-white text-sm" data-method="PUT">PUT</button>
                        <button class="method-btn px-3 py-1 rounded bg-danger text-white text-sm" data-method="DELETE">DELETE</button>
                    </div>
                </div>
                
                <div class="md:col-span-3">
                    <label for="url" class="block text-sm font-medium text-gray-700 mb-1">请求URL</label>
                    <div class="flex">
                        <input type="text" id="url" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary" 
                               value="http://192.168.1.41/api/production-hour">
                        <button id="send-btn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-r-md transition-colors">
                            <i class="fa fa-paper-plane mr-1"></i> 发送请求
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 请求参数区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-6">
            <!-- 请求参数/表单 -->
            <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-4">
                <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-pencil-square-o mr-2 text-primary"></i>请求参数
                </h2>
                
                <div id="params-container" class="space-y-3">
                    <!-- ID参数 (用于GET单个、PUT、DELETE) -->
                    <div id="id-param" class="hidden">
                        <label for="resource-id" class="block text-sm font-medium text-gray-700 mb-1">资源ID</label>
                        <input type="text" id="resource-id" placeholder="输入要操作的资源ID" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                    </div>
                    
                    <!-- 查询参数 (用于GET列表筛选) -->
                    <div id="query-params">
                        <div class="flex items-center mb-2">
                            <label class="block text-sm font-medium text-gray-700 mr-2">查询参数:</label>
                            <button id="add-query-param" class="text-sm text-primary hover:text-primary/80">
                                <i class="fa fa-plus-circle"></i> 添加参数
                            </button>
                        </div>
                        <div id="query-params-list" class="space-y-2">
                            <!-- <div class="flex query-param-item">
                                <input type="text" placeholder="参数名" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                                <input type="text" placeholder="参数值" class="flex-1 px-3 py-2 border-t border-b border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                                <button class="remove-query-param px-3 py-2 bg-gray-100 text-gray-500 hover:bg-gray-200 border border-gray-300 rounded-r-md">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div> -->
                            <div class="flex query-param-item">
                                <input type="text" placeholder="参数名" class="flex-2 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                                <input type="text" placeholder="参数值" class="flex-1 px-3 py-2 border-t border-b border-r border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                                <button class="remove-query-param px-3 py-2 bg-gray-100 text-gray-500 hover:bg-gray-200 border border-gray-300 rounded-r-md">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 请求体 (用于POST、PUT) -->
                    <div id="request-body" class="hidden">
                        <label for="body-json" class="block text-sm font-medium text-gray-700 mb-1">请求体 (JSON):</label>
                        <pre class="hidden" id="production-hour-schema">{
  "device_id": "CNC#001",
  "operator_name": "张三",
  "clamping_method": "压板",
  "meterial_type": "铝件",
  "production_date": "2025-07-31",
  "production_shift": "day",
  "time_slot": "08:00-09:00",
  "run_time": 3600,
  "workpiece_count": 50,
  "location": "LocalTest",
  "note": "正常生产"
}</pre>
                        <pre class="hidden" id="production-day-schema">{
  "device_id": "CNC#001",
  "operator_name": "张三",
  "clamping_method": "压板",
  "meterial_type": "铝件",
  "production_date": "2025-07-31",
  "production_shift": "day",
  "run_time": 3600,
  "workpiece_count": 50,
  "location": "LocalTest",
  "note": "正常生产"
}</pre>
                        <pre class="hidden" id="employees-schema">{
  "emp_id": "EMP001",
  "name": "张三"
}</pre>
                        <textarea id="body-json" rows="8" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary font-mono text-sm"
                                  placeholder="输入JSON格式的请求体"></textarea>
                    </div>
                </div>
            </div>
            
            <!-- 响应结果 -->
            <div class="lg:col-span-3 bg-white rounded-lg shadow-md p-4">
                <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fa fa-response mr-2 text-primary"></i>响应结果
                </h2>
                <div class="mb-2 flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="text-sm font-medium text-gray-700 mr-2">状态码:</span>
                        <span id="status-code" class="px-2 py-1 rounded text-sm font-medium bg-gray-100 text-gray-800">-</span>
                    </div>
                    <div>
                        <button id="copy-response" class="text-sm text-primary hover:text-primary/80 hidden">
                            <i class="fa fa-copy mr-1"></i> 复制响应
                        </button>
                    </div>
                </div>
                <div class="relative">
                    <pre id="response-body" class="bg-gray-50 p-4 rounded-md overflow-auto max-h-[500px] font-mono text-sm text-gray-800"><code>响应结果将显示在这里...</code></pre>
                </div>
            </div>
        </div>
        
        <footer class="text-center text-gray-500 text-sm mt-12">
            <p>API测试工具 &copy; 2025</p>
        </footer>
    </div>

    <script>
        // 全局状态
        const state = {
            currentEndpoint: 'production-hour',
            currentMethod: 'GET'
        };

        // DOM元素
        const elements = {
            endpointBtns: document.querySelectorAll('.endpoint-btn'),
            methodBtns: document.querySelectorAll('.method-btn'),
            urlInput: document.getElementById('url'),
            sendBtn: document.getElementById('send-btn'),
            idParam: document.getElementById('id-param'),
            resourceId: document.getElementById('resource-id'),
            queryParams: document.getElementById('query-params'),
            requestBody: document.getElementById('request-body'),
            bodyJson: document.getElementById('body-json'),
            addQueryParam: document.getElementById('add-query-param'),
            queryParamsList: document.getElementById('query-params-list'),
            statusCode: document.getElementById('status-code'),
            responseBody: document.getElementById('response-body'),
            copyResponse: document.getElementById('copy-response')
        };

        // 初始化
        function init() {
            setupEventListeners();
            updateUI();
            loadSchemaForEndpoint(state.currentEndpoint);
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 端点切换
            elements.endpointBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    state.currentEndpoint = btn.dataset.endpoint;
                    elements.endpointBtns.forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
                    elements.endpointBtns.forEach(b => b.classList.add('bg-gray-200', 'text-gray-700'));
                    btn.classList.add('active', 'bg-primary', 'text-white');
                    btn.classList.remove('bg-gray-200', 'text-gray-700');
                    updateUI();
                    loadSchemaForEndpoint(state.currentEndpoint);
                });
            });

            // 方法切换
            elements.methodBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    state.currentMethod = btn.dataset.method;
                    elements.methodBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateUI();
                });
            });

            // 添加查询参数
            elements.addQueryParam.addEventListener('click', addQueryParam);

            // 删除查询参数
            elements.queryParamsList.addEventListener('click', (e) => {
                if (e.target.closest('.remove-query-param')) {
                    const item = e.target.closest('.query-param-item');
                    if (elements.queryParamsList.children.length > 1) {
                        item.remove();
                    }
                }
            });

            // 发送请求
            elements.sendBtn.addEventListener('click', sendRequest);

            // 复制响应
            elements.copyResponse.addEventListener('click', copyResponseToClipboard);
        }

        // 更新UI
        function updateUI() {
            // 更新URL
            const baseUrl = `http://192.168.1.41/api/${state.currentEndpoint}`;
            elements.urlInput.value = baseUrl;

            // 根据方法显示不同的输入区域
            switch (state.currentMethod) {
                case 'GET':
                    elements.idParam.classList.remove('hidden');
                    elements.queryParams.classList.remove('hidden');
                    elements.requestBody.classList.add('hidden');
                    break;
                case 'POST':
                    elements.idParam.classList.add('hidden');
                    elements.queryParams.classList.add('hidden');
                    elements.requestBody.classList.remove('hidden');
                    elements.resourceId.value = '';
                    break;
                case 'PUT':
                case 'DELETE':
                    elements.idParam.classList.remove('hidden');
                    elements.queryParams.classList.add('hidden');
                    elements.requestBody.classList.toggle('hidden', state.currentMethod === 'DELETE');
                    break;
            }
        }

        // 加载端点对应的JSON schema
        function loadSchemaForEndpoint(endpoint) {
            const schemaElement = document.getElementById(`${endpoint}-schema`);
            if (schemaElement) {
                elements.bodyJson.value = schemaElement.textContent;
            }
        }

        // 添加查询参数
        function addQueryParam() {
            const paramItem = document.createElement('div');
            paramItem.className = 'flex query-param-item';
            paramItem.innerHTML = `
                <input type="text" placeholder="参数名" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                <input type="text" placeholder="参数值" class="flex-1 px-3 py-2 border-t border-b border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
                <button class="remove-query-param px-3 py-2 bg-gray-100 text-gray-500 hover:bg-gray-200 border border-gray-300 rounded-r-md">
                    <i class="fa fa-times"></i>
                </button>
            `;
            elements.queryParamsList.appendChild(paramItem);
        }

        // 收集查询参数
        function getQueryParams() {
            const params = new URLSearchParams();
            const paramItems = document.querySelectorAll('.query-param-item');
            
            paramItems.forEach(item => {
                const keyInput = item.querySelector('input:first-child');
                const valueInput = item.querySelector('input:last-child');
                
                if (keyInput.value && valueInput.value) {
                    params.append(keyInput.value, valueInput.value);
                }
            });
            
            return params.toString();
        }

        // 发送请求
        async function sendRequest() {
            let url = elements.urlInput.value;
            const method = state.currentMethod;
            
            // 添加ID到URL
            if (elements.resourceId.value && method !== 'POST') {
                url += `/${elements.resourceId.value}`;
            }
            
            // 添加查询参数
            if (method === 'GET' && !elements.resourceId.value) {
                const queryParams = getQueryParams();
                if (queryParams) {
                    url += `?${queryParams}`;
                }
            }
            
            // 准备请求选项
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            // 添加请求体
            if (['POST', 'PUT'].includes(method)) {
                try {
                    const body = JSON.parse(elements.bodyJson.value);
                    options.body = JSON.stringify(body);
                } catch (e) {
                    showError('无效的JSON格式');
                    return;
                }
            }
            
            // 发送请求
            try {
                elements.responseBody.innerHTML = '<code>加载中...</code>';
                elements.statusCode.textContent = '加载中';
                elements.statusCode.className = 'px-2 py-1 rounded text-sm font-medium bg-yellow-100 text-yellow-800';
                elements.copyResponse.classList.add('hidden');
                
                const response = await fetch(url, options);
                const data = await response.json().catch(() => null);
                
                // 更新状态码
                elements.statusCode.textContent = response.status;
                elements.statusCode.className = `px-2 py-1 rounded text-sm font-medium ${
                    response.ok ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                }`;
                
                // 显示响应
                elements.responseBody.innerHTML = '<code>' + JSON.stringify(data, null, 2) + '</code>';
                elements.copyResponse.classList.remove('hidden');
                
            } catch (error) {
                showError(error.message);
            }
        }

        // 显示错误
        function showError(message) {
            elements.statusCode.textContent = '错误';
            elements.statusCode.className = 'px-2 py-1 rounded text-sm font-medium bg-red-100 text-red-800';
            elements.responseBody.innerHTML = `<code class="text-red-600">${message}</code>`;
            elements.copyResponse.classList.add('hidden');
        }

        // 复制响应到剪贴板
        function copyResponseToClipboard() {
            const text = elements.responseBody.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = elements.copyResponse.innerHTML;
                elements.copyResponse.innerHTML = '<i class="fa fa-check mr-1"></i> 已复制';
                setTimeout(() => {
                    elements.copyResponse.innerHTML = originalText;
                }, 2000);
            });
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
